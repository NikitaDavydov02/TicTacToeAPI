# TicTacToeAPI
 Данный API предоставляет функционал игры в крестики-нолики на сервере.

 1. Общая информация о функционале API
 Для каждой игры создается файл на сервере, а также присваивается ID. Игра создается на сервере путем GET запроса по адресу "https://localhost:44310/api/TicTacToe/new".Если игра успешно создана, то сервер вернет её ID номер, иначе вернет ошибку.
 Для того, чтобы начать играть, необходимо подключиться к игре - передать на сервер её ID номер (осуществить GET запрос по адресу "https://localhost:44310/api/TicTacToe/{gameID}/connect") и получить в качестве ID номер игрока в этой игре, который сервер присвоил в ответ на запрос к подключению.
 Каждый ход, передаваемый на сервер, включает в себя три составляющих: ID игры, ID игрока в игре, сам ход. Для того, чтобы осуществить ход в игре, необходимо послать PUT запрос по адресу "https://localhost:44310/api/TicTacToe/{gameID}/turn", передав указанные три параметра. 
 Если все данные в запросе на осуществление хода корректны (игра с таким ID существует, игрок с таким ID подключен к игре, сам ход соответствует правилам игры), то файл игры на сервере изменяется в соответствии с ходом, после чего в качестве ответа на запрос клиенту возвращается измененная модель игры. В противном случае возвращается ошибка.
 Кроме того, через определенные интервалы времени сервер удаляет игры, которые не изменялись (к этим играм не подключались, не делали в них ходы) достаточно долго. Игрок может отключиться от игры по запросу на адрес "https://localhost:44310/api/TicTacToe/{gameID}/disconnect", передав свой playerID.

 2. Описание внутренних механизмов работы API
     2.1 Класс Turn
		Хранит информацию о ходе (номер клетки на поле по горизонтали и по вертикали)
	 2.2 Класс GameModel 
		Содержит информацию об игре и изменяет её при осуществлении ходов, а также назначает ID для подключающихся игроков.
		Основным полем этого класса является Field, где хранится информация о поле игры. Это поле реализовано как List<List<int>>, а не int[,], поскольку иначе возникала ошибка при записи двумерного массива в JSON. 
		Field для каждого поля хранит числа от 0 до 2: 0 - пустое поле; 1 - нолик; 2 - крестик. На каждом ходу (MakeATurn) проверяется, подключен ли игрок к игре, соответствует ли его ход правилам игры. Если ход не принят, то возвращается false. Иначе игра изменяется в соответствии с ходом, проверяется не закончена ли она. Если игра закончилась, то значение поля GameIsFinished меняется на true.
		Если игра закончена из-за переполнения поля, то значение поля FieldIsFull меняется на true. В качестве ответа возвращается объект GameModel, получив который клиент способен понять состояние игры после ходы, закончилась ли она, если да, то от переполнения поля или от того, что какой-то из игроков выиграл. После победы игрока не происходит смена очередности хода, поэтому если клиент получил игру со значениями GameIsFinished=true и FieldIsFull=false, значит выиграл тот, чей сейчас ход.
		При попытке подключения к игре (GenerateIDForPlayer) проверяется, есть ли свободное место в игре. Если да, то возвращается ID для подключающегося игрока, иначе возвращается null.
		
		*Была реализована самая простая генерация ID: либо 1, либо 2. Хотя такая генерация ID может создать проблемы, поскольку в разных играх будут игроки с одинаковым ID и если клиент поменяет только лишь ID игры, то он сможет делать ходы в другой игре, хотя он к ней не подключался. Стоит сделать генерацию уникальных ID, а также подключение к игре по паролю.
		
		Если игрок отключается от игры (LeaveTheGame), то игра обнуляет его ID.
	 2.3 Класс InitializeConnectionStruct
		Хранит информацию об игре, к которой осуществляется подключение, и назначенный в ходе подключения playreID. 
     2.4 Класс GameManager
	    Управляет файлами игр на сервере.
		DeleteOldGames() удаляет старые неиспользуемые игры на сервере;
		CreateNewGame() создает новую игру на сервере и возвращает её;
		FindIDForNewGame() находит неиспользованный ID для создаваемой игры;
		GetGameByID() возвращает игру, хранящуюся на сервере, по её ID;
		SaveGame() сохраняет игру в файл на сервере "Game[gameID]";
		DeleteGame() удаляет игру с сервера, если она на нём хранится.
